import { Extension, PluginConfiguration } from '@big-sister'
import loadPlugin from '../utility/loadPlugin'
import log from '../utility/logging'

const EXTENSION_DEFAULTS: Extension = {
  transformPresence: presence$ => presence$
}

export default async function loadExtensions(
  configurations: PluginConfiguration<any>[],
): Promise<Extension[]> {
  log.verbose(`Loading ${configurations.length} extension(s)...`)
  const extensions = []
  for (const configuration of configurations) {
    log.verbose(`Loading extension '${configuration.plugin}'...`)
    const extension = await loadPlugin(configuration.plugin, 'extension')(configuration.options)
    extensions.push({ ...EXTENSION_DEFAULTS, ...extension })
  }
  return extensions
}
