import { Configuration } from '@big-sister'
import { GraphQLSchema } from 'graphql'
import * as Koa from 'koa'
import * as graphql from 'koa-graphql'
import * as mount from 'koa-mount'
import * as serve from 'koa-static'
import * as path from 'path'
import log from '../utility/logging'

export default function startServer(
  configuration: Configuration['server'],
  schema: GraphQLSchema,
): void {
  const app = new Koa()
  app.use(mount('/api', graphql({ graphiql: configuration.graphiql, schema })))
  app.use(mount('/', serve(path.resolve(__dirname, '../../../../../dist-ui'))))
  app.listen(configuration.port, configuration.hostname)
  log.info(`Server started (${configuration.hostname}:${configuration.port})`)
}
