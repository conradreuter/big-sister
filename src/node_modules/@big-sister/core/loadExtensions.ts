import { Extension, PluginConfiguration } from '@big-sister'
import loadPlugin from './utility/loadPlugin'
import log from './utility/logging'

const EXTENSION_DEFAULTS: Extension = {
  transformPresence: presence$ => presence$
}

export default function loadExtensions(
  configurations: PluginConfiguration<any>[] = [],
): Promise<Extension[]> {
  log.verbose(`Loading ${configurations.length} extension(s)...`)
  return Promise.all(configurations.map(async configuration => {
    log.verbose(`Loading extension '${configuration.plugin}'...`)
    const extension = await loadPlugin(configuration.plugin, 'extension')(configuration.options)
    return { ...EXTENSION_DEFAULTS, ...extension }
  }))
}
