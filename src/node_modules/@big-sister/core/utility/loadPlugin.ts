import { ExtensionPlugin, SpyPlugin, StorePlugin } from '@big-sister'
import log from './logging'

/**
 * Load a plugin.
 */
export default function loadPlugin(name: string, type: 'spy'): SpyPlugin<any>
export default function loadPlugin(name: string, type: 'store'): StorePlugin<any>
export default function loadPlugin(name: string, type: 'extension'): ExtensionPlugin<any>
export default function loadPlugin(name: string, type: string): any {
  let plugin, pluginName
  try {
    pluginName = `@big-sister/${type}-${name}`
    plugin = require(pluginName)
  } catch {
    try {
      pluginName = name
      plugin = require(pluginName)
    } catch {
      throw new Error(`Unable to find plugin '${name}'. Please make sure it is installed`)
    }
  }
  log.info(`Plugin '${pluginName}' loaded`)
  return plugin.default
}
