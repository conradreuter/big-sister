import { ExportPlugin, PastPresence } from '@big-sister'
import createLogger from '@big-sister/logging'
import { sumBy } from 'lodash'
import { Observable } from 'rxjs'

const log = createLogger('export-json')

/**
 * Export the presence information as JSON.
 */
const plugin: ExportPlugin<{}> = async (options) => {
  return { generate, mimeType: 'application/json' }

  async function generate(presences: PastPresence[]): Promise<Buffer> {
    log.verbose(`Exporting ${sumBy(presences, 'intervals.length')} entries as JSON`)
    return Buffer.from(JSON.stringify(presences))
  }
}

export default plugin

