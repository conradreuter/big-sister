import { Observable } from 'rxjs'

/**
 * Identifies someone.
 */
export type Identifier = string

/**
 * Information about who is present.
 */
export type Presence = Identifier[]

/**
 * Provides presence information.
 */
export interface Spy {

  /**
   * The presence information provided by this spy.
   */
  readonly presence$: Observable<Presence>
}

/**
 * Provides a spy.
 */
export type SpyPlugin<TOptions extends {}> = (options: TOptions) => Promise<Spy>

/**
 * The configuration of a spy plugin.
 */
export interface SpyConfiguration<TOptions extends {}> {

  /**
   * The options passed to the spy plugin.
   */
  options: TOptions

  /**
   * The spy plugin to be used.
   */
  plugin: string
}

/**
 * Stores presence information.
 */
export interface Store {

  /**
   * Update the stored presence information.
   */
}

/**
 * A plugin that provides a store.
 */
export type StorePlugin<TOptions extends {}> = (options: TOptions) => Promise<Store>

/**
 * The configuration of a store plugin.
 */
export interface StoreConfiguration<TOptions extends {}> {

  /**
   * The options passed to the store plugin.
   */
  options: TOptions

  /**
   * The store plugin to be used.
   */
  plugin: string
}

/**
 * Extends the functionality of the application.
 */
export interface Extension {

  /**
   * Transform the presence information provided by the spy.
   */
  transformPresence(presence$: Observable<Presence>): Observable<Presence>
}

/**
 * A plugin that provides an extension.
 */
export type ExtensionPlugin<TOptions extends {}> = (options: TOptions) => Promise<Partial<Extension>>

/**
 * The configuration of an extension plugin.
 */
export interface ExtensionConfiguration<TOptions extends {}> {

  /**
   * The options passed to the extension plugin.
   */
  options: TOptions

  /**
   * The extension plugin to be used.
   */
  plugin: string
}

/**
 * The application's configuration.
 */
export interface Configuration {

  /**
   * The configurations of the extensions.
   */
  extensions?: ExtensionConfiguration<any>[]

  /**
   * The configuration of the spy.
   */
  spy: SpyConfiguration<any>

  /**
   * The configuration of the store.
   */
  store: StoreConfiguration<any>
}
