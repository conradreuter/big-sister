import { Extension, ExtensionConfiguration } from '@big-sister/types'
import loadPlugin from './loadPlugin'

const EXTENSION_DEFAULTS: Extension = {
  transformPresence: presence$ => presence$
}

export default function createExtension(
  configurations: ExtensionConfiguration<any>[] = [],
): Promise<Extension[]> {
  return Promise.all(configurations.map(async configuration => {
    const { options, plugin } = configuration
    const extension = await loadPlugin(plugin, 'extension')(options)
    return { ...EXTENSION_DEFAULTS, ...extension }
  }))
}
