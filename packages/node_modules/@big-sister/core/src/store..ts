import { Store } from '@big-sister/types'
import Configuration from './configuration'
import loadPlugin from './loadPlugin'

let instancePromise: Promise<Store>

export default {

  get instance(): Promise<Store> {
    return instancePromise || (instancePromise = loadStore())
  }
}

function loadStore(): Promise<Store> {
  const { plugin, ...options } = Configuration.instance.store
  return loadPlugin(plugin, 'store')(options)
}
