import { Extension, ExtensionConfiguration } from '@big-sister/types'
import loadPlugin from './utility/loadPlugin'

const EXTENSION_DEFAULTS: Extension = {
  transformPresence: presence$ => presence$
}

export default function loadExtensions(
  configurations: ExtensionConfiguration<any>[] = [],
): Promise<Extension[]> {
  return Promise.all(configurations.map(async configuration => {
    const extension = await loadPlugin(configuration.plugin, 'extension')(configuration.options)
    return { ...EXTENSION_DEFAULTS, ...extension }
  }))
}
