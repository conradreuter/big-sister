import { Spy } from '@big-sister/types'
import Configuration from './configuration'
import loadPlugin from './loadPlugin'

let instancePromise: Promise<Spy>

export default {

  get instance(): Promise<Spy> {
    return instancePromise || (instancePromise = loadSpy())
  }
}

function loadSpy(): Promise<Spy> {
  const { plugin, ...options } = Configuration.instance.spy
  return loadPlugin(plugin, 'spy')(options)
}
